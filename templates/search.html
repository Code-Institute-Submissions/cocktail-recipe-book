{% extends 'base.html'%} {% block content %}
<h2 class="art-deco-font">Search for a cocktail</h2>
<!-- Attempt with example - START -->
<div class="container" id="selector-container">
    <p>A meaningless example of multiple selectMenus on some random data...</p>
    <div id="select1">
    </div>
    <div id="select2">
    </div>
    <div id="select3">
    </div>
    <div id="select4">
    </div>
<!--<div style="clear: both"></div>-->
<div id="datatable"></div>

<!-- Attempt with example - END -->

<p id="hidden-recipes-search" hidden>{{recipes|safe}}</p>
<script>
/*global $*/
/*global dc*/
/*global crossfilter*/

    $(document).ready(function() {
                
        var recipesText = $('#hidden-recipes-search').text();
        var recipesJson = JSON.parse(recipesText);
        
        var recipesList = [];
        
        for (i in recipesJson) {
            recipesList.push(recipesJson[i]);
        }
        
        // Getting search - START
        var select1 = dc.selectMenu('#select1'),
            select2 = dc.selectMenu('#select2'),
            select3 = dc.selectMenu('#select3'),
            select4 = dc.selectMenu('#select4'),
            datatable = dc.dataTable('#datatable');
            
        // Fixing the selector classes - START

        $('#selector-container').find('select').addClass('browser-default');
        // Fixing the selector classes - END
            
        // create vars for selector
        var baseSpirits = []
        for (var i =0; i < recipesList.length; i++) {
            baseSpirits.push(recipesList[i]['base_spirit'])
        }
        var cocktailType = []
        for (var i =0; i < recipesList.length; i++) {
            cocktailType.push(recipesList[i]['cocktail_type'])
        }
        var flavourProfile = []
        for (var i =0; i < recipesList.length; i++) {
            flavourProfile.push(recipesList[i]['flavour_profile'])
        }
        var isVegan = []
        for (var i =0; i < recipesList.length; i++) {
            isVegan.push(recipesList[i]['is_vegan'])
        }
        
        // Create vars for table content
        var recipeName = []
        for (var i =0; i < recipesList.length; i++) {
            recipeName.push(recipesList[i]['recipe_name'])
        }
        
        var ndx = crossfilter(recipesList),
            spiritDimension = ndx.dimension(function(d) { return d.base_spirit; }),
            typeDimension = ndx.dimension(function(d) { return d.cocktail_type; }),
            flavourDimension = ndx.dimension(function(d) { return d.flavour_profile; }),
            veganDimension = ndx.dimension(function(d) { return d.is_vegan; }),
            nameDimension = ndx.dimension(function(d) { return d.recipe_name; });
        select1
            .dimension(spiritDimension)
            .group(spiritDimension.group())
            .controlsUseVisibility(true);
        select2
            .dimension(typeDimension)
            .group(typeDimension.group())
            // .multiple(true)
            // .numberVisible(10)
            .controlsUseVisibility(true);
        select3
            .dimension(flavourDimension)
            .group(flavourDimension.group())
            // .multiple(true)
            // .numberVisible(10)
            .controlsUseVisibility(true);
        select4
            .dimension(veganDimension)
            .group(veganDimension.group())
            .controlsUseVisibility(true);
        datatable
            .dimension(nameDimension)
            .group(function(d) { return d.recipe_name; })
            .columns(['Name', 'flavour'])
            .size(recipesList.length);
            
        dc.renderAll();
        // Getting search - END
        
    });
</script>
{% endblock %}